<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction confirmation | The Yank of yEAh</title>
    <link rel="icon" type="image/svg+xml" href="https://ugc.ynwk.org/app/60dea10d-47f2-48dc-bea3-72e95ad247f4/icon.svg">
    <link rel="stylesheet" href="/css/output.css">
    <style>
        .modal {
            background-color: #0C0E14 !important;
            border-width: 3px;
        }
    </style>
</head>

<body style=background-color:#0C0E14>
    <style>
        .loading {
            display: none;
            margin-top: 20px;
            text-align: center;
            color: white;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #0c0e14;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            border: 4px solid #1d1f24;
            border-top: 4px solid #ff4747;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
    <div class="loading-overlay">
        <div class="loader"></div>
    </div>
    <script>
        if (document.cookie.indexOf("yeahgames_userdata=") === -1) {
            window.location.href = "https://accounts.ynwk.org/login?continue=" + encodeURIComponent(window.location.href);
        }
    </script>
    <script>
        window.addEventListener('load', function () {
            var loaderOverlay = document.querySelector('.loading-overlay');
            loaderOverlay.style.display = 'none';
        });
    </script>

    <div style="width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;background-color:#0C0E14!important">
        <div style="margin:auto;display:grid;border-radius:3px;border-color:#1D1F24;border-width:2px;margin-top:auto;background-color:#0C0E14!important"
            class="money w-full max-w-sm rounded-lg bg-white shadow-md duration-300 hover:scale-105 hover:shadow-xl">
            <div style="background-color:#1D1F24;color:white;font-weight:bolder;font-size:small;border-top-right-radius:3px;border-top-left-radius:3px;border-top-right-radius:3px;border-top-left-radius:3px"
                class="bg-gray-100 py-2 text-center">TRANSACTION CONFIRMATION
            </div>
            <div style="background-color:#ff4747;color:white;font-weight:bolder;font-size:small;"
                class="bg-gray-100 py-2 text-center">FROM
            </div>
            <img style="border-radius: 50%" id="fromPfp" src="https://ugc.ynwk.org/profile/p/default/png/default.png"
                onerror="this.src='https://ugc.ynwk.org/profile/p/default/png/default.png';"
                class="mx-auto mt-8 h-16 w-16 text-green-400">
            <h1 class="mt-2 text-center text-2xl font-bold text-gray-400"><span id="from"></span> <br><span
                    style="font-size: 0.8rem; background-color: #ff4747; color: white; padding: 5px; border-radius: 5px;">YOU</span>
            </h1>
            <br>
            <div style="background-color:#1D1F24;color:white;" class="space-x-4 bg-gray-100 py-4 text-center">
                <p class="items-center justify-center text-center">&#160;<span style="font-size: 3rem;color:white"><img
                            alt="Y" style="width: 20px; display: inline"
                            src="https://cdn.ynwk.org/img/general/symbols/yollars/light.svg">&#160;<span
                            id="amount">0.0000</span></span></p>
            </div>

            <div style="color:white;font-weight:bolder;font-size:small"
                class="bg-green-500 bg-gray-100 py-2 text-center">TO
            </div>
            <img style="border-radius: 50%" id="toPfp"
                onerror="this.src='https://ugc.ynwk.org/profile/p/default/png/default.png';"
                src="https://ugc.ynwk.org/profile/p/default/png/default.png"
                class="mx-auto mt-8 h-16 w-16 text-green-400">
            <h1 class="mt-2 text-center text-2xl font-bold text-gray-400"><span id="to">username</span></h1><br>
            <div style="background-color:#1D1F24;border-bottom-right-radius:3px;border-bottom-left-radius:3px;"
                class="space-x-4 bg-gray-100 py-4 text-center">
                <button onclick="window.location.href = ('https://my.bank.ynwk.org')"
                    class="inline-block rounded-md bg-red-500 px-10 py-2 font-semibold text-red-100 shadow-md duration-75 hover:bg-red-400">Cancel</button>
                <button id="confirm"
                    class="inline-block rounded-md bg-green-500 px-6 py-2 font-semibold text-green-100 shadow-md duration-75 hover:bg-green-400">&#160;&#160;Confirm&#160;<span
                        id="loader" class="hidden"><svg width="16" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto;display:block;display:inline"
                            viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
                            <circle cx="50" cy="50" fill="none" stroke="white" stroke-width="10" r="33"
                                stroke-dasharray="155.50883635269477 53.83627878423159">
                                <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite"
                                    dur="0.8474576271186441s" values="0 50 50;360 50 50" keyTimes="0;1">
                                </animateTransform>
                            </circle>
                        </svg></span>&#160;</button>
            </div>
        </div>
    </div>

    <div id="transactionSuccess"
        class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction success</h2>
            <p>Your transaction succeeded. <br>You will receive a receipt via email shortly.</p>
            <button onclick="window.location.href = 'https://my.bank.ynwk.org'" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>

    <div id="generalError" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Failed to complete transaction. Try again later.</p>
            <button onclick="addHiddenClass('generalError')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="authError" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Authorization error. Try logging out and back in again.</p>
            <button onclick="addHiddenClass('authError')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="missingData" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Missing recipient or amount.</p>
            <button onclick="addHiddenClass('missingData')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="toYourself" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Cannot transfer money to yourself.</p>
            <button onclick="addHiddenClass('toYourself')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="positiveNumber" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Amount must be a positive number.</p>
            <button onclick="addHiddenClass('positiveNumber')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="databaseError" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>Something went wrong on our end. Try again later.</p>
            <button onclick="addHiddenClass('databaseError')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="senderNotFound" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>You don't have a connected bank account.</p>
            <button onclick="addHiddenClass('senderNotFound')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="insufficientFunds"
        class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>You don't have enough funds to complete the transaction.</p>
            <button onclick="addHiddenClass('insufficientFunds')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>
    <div id="recipientNotFound"
        class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
        <div class="modal bg-gray-800 border-gray-700 text-white rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Transaction failed</h2>
            <p>The recipient does not have a connected bank account.</p>
            <button onclick="addHiddenClass('recipientNotFound')" style="background-color:#ff4747"
                class="mt-4 px-4 py-2 text-white rounded-lg">Close</button>
        </div>
    </div>


    <script>
        function getQueryStringValue(key) {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            return urlParams.get(key);
        }

        const recipient = getQueryStringValue('to');
        const queryAmount = getQueryStringValue('amount');
        const amount = parseFloat(queryAmount).toFixed(4);
        const sender = getUsernameFromCookie();
        console.log(sender)

        const toElement = document.getElementById('to');
        if (toElement && recipient !== null) {
            toElement.textContent = recipient;

            const pfpUrl = `https://ugc.yeahgames.net/profile/p/default/png/@${recipient}.png`;
            const toPfpElement = document.getElementById('toPfp');
            if (toPfpElement) {
                toPfpElement.src = pfpUrl;
            }
        }

        const fromElement = document.getElementById('from');
        if (fromElement && sender !== null) {
            fromElement.textContent = sender;

            const pfpUrl = `https://ugc.yeahgames.net/profile/p/default/png/@${sender}.png`;
            const fromPfpElement = document.getElementById('fromPfp');
            if (fromPfpElement) {
                fromPfpElement.src = pfpUrl;
            }
        }

        const amountElement = document.getElementById('amount');
        if (amountElement && amount !== null) {
            amountElement.textContent = amount;
        }

        function getUsernameFromCookie() {
            const cookieName = "yeahgames_userdata=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const cookieArray = decodedCookie.split(';');

            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i];
                while (cookie.charAt(0) === ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(cookieName) === 0) {
                    const cookieValue = cookie.substring(cookieName.length, cookie.length);
                    try {
                        const userData = JSON.parse(cookieValue);
                        if (userData && userData.username) {
                            return userData.username;
                        }
                    } catch (error) {
                        console.error("Error parsing the yeahgames_userdata cookie:", error);
                    }
                }
            }
            return null;
        }


        document.getElementById('confirm').addEventListener('click', () => {
            removeHiddenClass('loader');

            const payload = {
                recipient: recipient,
                amount: parseFloat(amount)
            };

            const url = 'https://tr.ynk.ynwk.org';

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload),
                credentials: 'include',
            })
                .then(response => {
                    return response.json().then(data => ({
                        data: data,
                        ok: response.ok
                    }));
                })
                .then(({ data, ok }) => {
                    console.log('Response from server:', data);

                    if (data && data.nec) {
                        const necValue = data.nec;

                        if (necValue === 5500) {
                            removeHiddenClass("transactionSuccess");
                        } else if (necValue === 5501) {
                            removeHiddenClass("authError");
                        } else if (necValue === 5502) {
                            removeHiddenClass("authError")
                        } else if (necValue === 5511) {
                            removeHiddenClass("missingData")
                        } else if (necValue === 5518) {
                            removeHiddenClass("toYourself")
                        } else if (necValue === 5521) {
                            removeHiddenClass("positiveNumber")
                        } else if (necValue === 5551) {
                            removeHiddenClass("databaseError")
                        } else if (necValue === 5519) {
                            removeHiddenClass("senderNotFound")
                        } else if (necValue === 5516) {
                            removeHiddenClass("insufficientFunds")
                        } else if (necValue === 5515) {
                            removeHiddenClass("recipientNotFound")
                        } else if (necValue === 5552) {
                            removeHiddenClass("databaseError")
                        } else if (necValue === 5553) {
                            removeHiddenClass("databaseError")
                        } else if (necValue === 5550) {
                            removeHiddenClass("generalError")
                        } else {
                            removeHiddenClass("generalError");
                            console.error('Unknown nec');
                        }

                    } else {
                        removeHiddenClass("generalError");
                        console.error('No "nec" value in the response');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    removeHiddenClass("generalError");
                })
                .finally(() => {
                    addHiddenClass("loader");
                });
        });

        function removeHiddenClass(id) {
            var element = document.getElementById(id);

            if (element) {
                element.classList.remove('hidden');
            }
        }

        function addHiddenClass(id) {
            var element = document.getElementById(id);

            if (element) {
                element.classList.add('hidden');
            }
        }
    </script>

</body>